<script src="source/plugin/qxt_login/plugins/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
  var jq=jQuery.noConflict();
  var mobile;
  var smsseccode;
  var passwd;
  jq(function(){
	  jq('#mobile').focus(function() {jq("#mobile").removeClass("er");});
	  jq('#smsseccode').focus(function() {jq("#smsseccode").removeClass("er");});
	  jq('#passwd').focus(function() {jq("#passwd").removeClass("er");});
  });
  function sendsmssec() {
	  mobile=jq("#mobile").val();
      if (!is_phone_number(mobile)) {
          jq("#mobile").addClass("er");
          return;
      }
      showWindow('sendsms', 'plugin.php?id=qxt_login&action=sendsms');
  }
  function is_phone_number(a) {   
      if(!(/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(a))){
		  return false;
	  }   
	  return true;
  }
  function bdsubmit() {
	  mobile=jq("#mobile").val();
	  smsseccode=jq("#smsseccode").val();
	  passwd=jq("#passwd").val();
      if (!is_phone_number(mobile)) {
          jq("#mobile").addClass("er");
      }
	  if (smsseccode=="") {
		  jq("#smsseccode").addClass("er");
	  }
	  if (passwd=="") {
		  jq("#passwd").addClass("er");
	  }
	  if(!is_phone_number(mobile) || smsseccode=="" || passwd=="") {
		  return false;
	  }
	  ajaxpost('bindform', 'return_bindform');
	  return false;
  }
  var leftseconds=0;
  function after_send() {
      leftseconds=60;
      disable_smsbtn();
  }
  function disable_smsbtn() {
      var dom = document.getElementById('smsbtn');
      dom.disabled=true;
      dom.innerHTML = leftseconds+" {lang qxt_login:login_resendtip}";
      --leftseconds;
      if (leftseconds<=0) {
          dom.innerHTML = "<a class='xi2' href='javascript:sendsmssec();'>{lang qxt_login:login_resendsec}</a>";
          return; 
      }
      setTimeout(disable_smsbtn, 1000);
  }
  
   function sms_submit() {
      var errmsgdom = document.getElementById('sms_error_msg');
      errmsgdom.innerHTML = "";
      var seccodeverify = jq("#formsms input[name='seccodeverify']").val();
      var seccodehash = jq("#formsms input[name='seccodehash']").val();
      if (seccodeverify=="") {
          errmsgdom.innerHTML = "{lang qxt_login:tip_imgsec}";
          jq("#formsms input[name='seccodeverify']").focus();
          return;
      }
      var params = {
          seccodeverify: seccodeverify,
          seccodehash: seccodehash,
          mobile: mobile,
		  type: 2
      };
      //console.log(params);
      jq.ajax({
          type: "post",
          async: true,
          url: 'plugin.php?id=qxt_login&action=sendsms&formhash={FORMHASH}',
          data: params,
          dataType: "json",
          complete: function(res) {},
          success: function (res) {
              if (res.flag == "fail") {
                  errmsgdom.innerHTML = res.message;
              } else {
                  hideWindow('sendsms');
                  after_send();
              }
          },
          error: function (data) {
              errmsgdom.innerHTML = "error: "+data;
          }
      });
  } 
</script>
<ul class="tb cl">
  <li class="a"><a href="home.php?mod=spacecp&ac=plugin&id=qxt_login:bind">{lang qxt_login:bind_title}</a></li>
</ul>
<p class="tbmu mbm">{lang qxt_login:bind_desc}</p>
<div class="mtw bm2 cl">
  <div class="bm2_b bw0">
    <form id="bindform" name="bindform" method="post" autocomplete="off" action="home.php?mod=spacecp&ac=plugin&id=qxt_login:bind" onsubmit="bdsubmit();return false;">
      <input type="hidden" name="formhash" value="{FORMHASH}" />
      <input type="hidden" name="bindsubmit" value="true" />
      <input type="hidden" name="handlekey" value="bindmobile" />
      <table class="tfm" cellspacing="0" cellpadding="0">
        <tbody>
          <!--{if $_G['bindmb']}-->
          <tr>
            <th class="xi1">{lang qxt_login:bind_mb}</th>
            <td><b>$_G['bindmb']</b></td>
          </tr>
          <!--{/if}-->
          <tr>
            <th><span class="rq">*</span>{lang qxt_login:bind_pass}</th>
            <td><input name="passwd" type="password" class="px" id="passwd" style="width:200px;" value="" autocomplete="off"></td>
          </tr>
          <tr>
            <th><span class="rq">*</span>{lang qxt_login:bind_mobile}</th>
            <td><input name="mobile" id="mobile" class="px" type="text" style="width:200px;" value="" autocomplete="off"></td>
          </tr>
          <tr>
            <th><span class="rq">*</span>{lang qxt_login:login_smssec}</th>
            <td><input name="smsseccode" id="smsseccode" class="px" type="text" style="width:100px;" value="" autocomplete="off">
              &nbsp;<span id='smsbtn'><a class='xi2' href="javascript:sendsmssec();">{lang qxt_login:login_sendsec}</a></span></td>
          </tr>
          <tr>
            <th>&nbsp;</th>
            <td><button type="submit" id="bindsubmit_btn" name="bindsubmit_btn" value="true" class="pn pnc"><strong>{lang submit}</strong></button></td>
          </tr>
        </tbody>
      </table>
    </form>
  </div>
  <div class="bm2_b bm2_b_y bw0">
    {lang qxt_login:qxt_login_desc}
  </div>
</div>
<span style="display: none" id="return_bindform"></span> 
<script type="text/javascript">
	function errorhandle_bindmobile(message){
		showDialog(message, 'alert', "", null, true, null, "", "", "", 3);
	}
</script> 
