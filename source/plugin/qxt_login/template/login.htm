<!--{template common/header}-->
<!--{if empty($_GET['infloat'])}-->
<div id="ct" class="ptm wp w cl">
  <div class="mn" id="main_message">
    <div class="bm">
      <div class="bm_h bbs"> <span class="y"> <a href="member.php?mod={$_G[setting][regname]}" class="xi2">{lang qxt_login:login_guest}</a> </span>
        <h3 class="xs2">{lang qxt_login:login_bysmssec}</h3>
      </div>
<!--{/if}-->
      
      <div id="main_messaqge">
        <div id="layer_login">
          <h3 class="flb"> <em id="returnmessage"> 
            <!--{if !empty($_GET['infloat'])}-->{lang qxt_login:login_bysmssec}<!--{/if}--> 
            </em> <span><!--{if !empty($_GET['infloat']) && !isset($_GET['frommessage'])}--><a href="javascript:;" class="flbc" onclick="hideWindow('$_GET[handlekey]', 0, 1);" title="{lang close}">{lang close}</a><!--{/if}--></span> </h3>
          <form method="post" autocomplete="off" name="login" id="loginform" class="cl" onsubmit="lnsubmit();return false;" action="plugin.php?id=qxt_login&loginsubmit=yes">
            <div class="c cl">
              <input type="hidden" name="formhash" value="{FORMHASH}" />
              <input type="hidden" name="referer" value="{echo dreferer()}" />
              <div class="rfm">
                <table>
                  <tr>
                    <th><label for="mobile">{lang qxt_login:login_mobile}:</label></th>
                    <td><input name="mobile" id="mobile" autocomplete="off" size="30" class="px p_fre" tabindex="1" value="" type="text"></td>
                  </tr>
                </table>
              </div>
              <div class="rfm">
              <!--{eval $seccodecheck = 1;}--> 
              <!--{block sectpl}--><table><tr><th><sec>: </th><td><sec><br /><sec></td><td id="sms_error_msg" style="color:red; font-weight:bold;"></td></tr></table><!--{/block}-->
              <!--{subtemplate common/seccheck}-->
              </div>
              <div class="rfm">
                <table>
                  <tr>
                    <th><label for="smsseccode">{lang qxt_login:login_smssec}:</label></th>
                    <td><input id="smsseccode" name="smsseccode" autocomplete="off" style="ime-mode:disabled;width:100px" class="px vm" tabindex="1" type="text"></td>
                    <td class="tipcol" id='smsbtn'><a href="javascript:sendsmssec();">{lang qxt_login:login_sendsec}</a></td>
                  </tr>
                </table>
              </div>
              <div class="rfm {if !empty($_GET['infloat'])} bw0{/if}">
                <table>
                  <tr>
                    <th></th>
                    <td><label for="cookietime">
                        <input type="checkbox" class="pc" name="cookietime" id="cookietime" tabindex="1" value="2592000" $cookietimecheck />
                        {lang login_permanent}</label></td>
                  </tr>
                </table>
              </div>
              <div class="rfm mbw bw0">
                <table width="100%">
                  <tr>
                    <th>&nbsp;</th>
                    <td><button class="pn pnc" type="submit" name="loginsubmit" value="true" tabindex="1"><strong>{lang login}</strong></button></td>
                    <td></td>
                  </tr>
                </table>
              </div>
            </div>
          </form>
        </div>
      </div>
<script type="text/javascript">
  var mobile;
  var smsseccode;
  jq(function(){
	  jq("#mobile").focus(function() {jq("#mobile").removeClass("er");});
	  jq("#smsseccode").focus(function() {jq("#smsseccode").removeClass("er");});
	  //jq("#loginform input[name='seccodeverify']").focus(function() {console.log("ok");jq("#loginform input[name='seccodeverify']").removeClass("er");});
	  jq("body").on("click","#loginform input[name='seccodeverify']",function() {jq("#loginform input[name='seccodeverify']").removeClass("er");});
  });
  function sendsmssec() {
	  mobile=jq("#mobile").val();
	  if (!is_phone_number(mobile)) {
          jq("#mobile").addClass("er");
      }
	  var errmsgdom = document.getElementById('sms_error_msg');
      errmsgdom.innerHTML = "";
      var seccodeverify = jq("#loginform input[name='seccodeverify']").val();
      var seccodehash = jq("#loginform input[name='seccodehash']").val();
      if (seccodeverify=="") {
          jq("#loginform input[name='seccodeverify']").addClass("er");
      }
	  if(!is_phone_number(mobile) || seccodeverify=="") {
		  return;
	  }
	  var params = {
          seccodeverify: seccodeverify,
          seccodehash: seccodehash,
          mobile: mobile,
		  type: 3
      };
	  jq.ajax({
          type: "post",
          async: true,
          url: 'plugin.php?id=qxt_login&action=sendsms&formhash={FORMHASH}',
          data: params,
          dataType: "json",
          complete: function(res) {},
          success: function (res) {
              if (res.flag == "fail") {
                  errmsgdom.innerHTML = res.message;
              } else {
				  errmsgdom.innerHTML = "";
                  after_send();
              }
          },
          error: function (data) {
              errmsgdom.innerHTML = "error: "+data;
          }
      });
  }
  var leftseconds=0;
  function after_send() {
      leftseconds=60;
      disable_smsbtn();
  }
  function disable_smsbtn() {
      var dom = document.getElementById('smsbtn');
      dom.disabled=true;
      dom.innerHTML = leftseconds+" {lang qxt_login:login_resendtip}";
      --leftseconds;
      if (leftseconds<=0) {
          dom.innerHTML = "<a href='javascript:sendsmssec();'>{lang qxt_login:login_resendsec}</a>";
          return; 
      }
      setTimeout(disable_smsbtn, 1000);
  }
  function lnsubmit() {
	  mobile=jq("#mobile").val();
	  smsseccode=jq("#smsseccode").val();
	  if (!is_phone_number(mobile)) {
          jq("#mobile").addClass("er");
      }
	  if (smsseccode=="") {
		  jq("#smsseccode").addClass("er");
	  }
	  if(!is_phone_number(mobile) || smsseccode=="") {
		  return false;
	  }
	  ajaxpost('loginform', 'returnmessage', 'returnmessage', 'onerror');
	  return false;
  }
  function is_phone_number(a) {   
      if(!(/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(a))){
		  return false;
	  }   
	  return true;
  }
</script>
<!--{if empty($_GET['infloat'])}--> 
    </div>
  </div>
</div>
<!--{/if}-->
<!--{template common/footer}-->