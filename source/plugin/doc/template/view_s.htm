<!--{template common/header}-->
<link href="./source/plugin/doc/css/com.css" rel="stylesheet" type="text/css"/>
<link href="./source/plugin/doc/css/ds-view.css" rel="stylesheet" type="text/css"/>
<script src="./source/plugin/doc/js/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    jQuery.noConflict();
    jQuery(function ($) {
        var width = $("#wp").width();
        var lwidth = width - 200;
        var doc_width = lwidth - 4;

        $(".ds-container-left").width(lwidth);

        $(document).delegate(".ds-pagelist a", "click", function () {
            var p = $(this).attr('p');
            jQuery.post("plugin.php?id=doc:view", {action: "getcomment", d: $docid, p: p, formhash: '{FORMHASH}'}, function (data) {
                var data2 = data.split("|");
                var list = data2[0];
                var page = data2[1];
                $("#ds-user-comments-list").html(list);
                $(".ds-pagelist").html(page);
            });
        });
        $(document).delegate(".ds-user-comments-del", "click", function () {
            var c = $(this).parent().parent();
            var commentid = c.attr("commentid");
            c.remove();
            jQuery.post("plugin.php?id=doc:view", {action: "delcomment", d: $docid, commentid: commentid, formhash: '{FORMHASH}'}, function (data) {
                showDialog(data, "notice", "", "", 0);
            });
        });

        $(".ds-user-comment-submit").click(function () {
            var star = $("#star_num").text();
            star = parseInt(star);
            var comment = $(".ds-user-comment-body").val();
            if (star == 0) {
                showDialog("{lang doc:view_pleasestar}", "notice", "", "", 0);
                return;
            }
            if (comment == "") {
                showDialog("{lang doc:view_pleasecomment}", "notice", "", "", 0);
                return;
            }
            jQuery.post("plugin.php?id=doc:view", {action: "insertcomment", d: $docid, comment: comment, star: star, formhash: '{FORMHASH}'}, function (data) {
                showDialog(data, "notice", "", "", 0);
                star = star * 16.2;
                        $("#ds-user-comments-list").prepend('<div class="ds-user-comments-list"><img class="ds-user-comments-upic" src="uc_server/avatar.php?uid=$_G['uid']&size=small"/><div class="ds-user-comments-h1"><span style="width:' + star + 'px" class="ds-user-comments-star"></span><span class="ds-user-comments-user">$_G['username']</span></div><div class="ds-user-comments-text">' + comment + '</div><div class="ds-user-comments-time">{lang doc:view_yoursoon}</div></div>');
            });
        });

        $(".ds-user-comment-title i").mouseover(function () {
            var star = $(this).attr("id");
            star = star.replace("star_", "");
            for (var i = 1; i <= 5; i++) {
                $("#star_" + i).removeClass("hover");
            }
            for (var i = 1; i <= star; i++) {
                $("#star_" + i).addClass("hover");
            }
            $("#star_num").text(star + " {lang doc:view_xing}");
        });
    });
    function OpentDown()
    {
        jQuery(".ds-page-move").hide();
        showDialog('<p>{lang doc:view_spendextcredits}$doc_downcreditname[0]:<span style="color:#f00">$downpay</span>$doc_downcreditname[1] <span style="margin-left:10px;color:#33AA9B">[{lang doc:view_vipfreedown}]<span></p>{lang doc:view_suredown}', 'confirm', '{lang doc:view_note}', 'StartDown()', 1, 'CloseDown()');
    }
    function CloseDown()
    {
        jQuery(".ds-page-move").show();
    }
    function StartDown()
    {
        jQuery(".ds-page-move").show();
        if ($doc_rewrite) {
            window.location.href = 'down-$docid.html';
        } else {
            window.location.href = 'plugin.php?id=doc:down&d=$docid';
        }
    }
</script>
<div id="wp" class="wp">
    <div id="pt" class="bm cl">
        <div class="z">
            <a class="nvhm" title="$_G['setting']['bbname']" href="./">$_G['setting']['bbname']</a><em></em><a href="<!--{if $doc_rewrite}-->doc-doc.html<!--{else}-->plugin.php?id=doc<!--{/if}-->">$doc_name</a><em></em>{lang doc:view_read}
        </div></div>	
    <div class="wp cl">    
        <div class="ds-header">
            <div class="ds-toobar">             
            </div>
            <div class="ds-toolbar-copy">{lang doc:view_copy0}  <a href="http://www.docswf.com">{lang doc:view_copy1}</a>{lang doc:view_copy2}</div>
        </div>
        <div class="ds-container">
            <div class="ds-container-left">
                <div class="ds-head">
                    <div class="ds-head-title"><i class="$docexeten"></i>$title</div>
                    <div class="ds-head-doc"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-judge-i">($doc_commentcount {lang doc:view_percomment})</span><span class="ds-read-count">$viewcount {lang doc:doc_perread}</span><span class="ds-down-count">$downcount {lang doc:doc_perdown}</span></div>
                </div>
                <div class="ds-read">
                    <div class="ds-pages">
						<p>
                        $txt
						</p>
                    </div>
                    <div class="ds-page-sp"><a href="<!--{if $doc_rewrite}-->view-$docid-$link.html<!--{else}-->plugin.php?id=doc:view&d=$docid&ps=$link<!--{/if}-->">{lang doc:nextpage}</a></div>
					<ul>
						<!--{if $lastdoc }-->
						<li>{lang doc:view_lastdoc} : <a href="<!--{if $doc_rewrite}-->view-$lastdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$lastdoc[0]<!--{/if}-->" title="$lastdoc[5]">$lastdoc[5]</a></li>
						<!--{else}-->
						<li>{lang doc:view_lastdoc} : {lang doc:view_nodoc}</li>
						<!--{/if}-->
						<!--{if $nextdoc }-->
						<li>{lang doc:view_nextdoc} : <a href="<!--{if $doc_rewrite}-->view-$nextdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$nextdoc[0]<!--{/if}-->" title="$nextdoc[5]">$nextdoc[5]</a></li>
						<!--{else}-->
						<li>{lang doc:view_nextdoc} : {lang doc:view_nodoc}</li>
						<!--{/if}-->
					</ul>				
                </div>
                <div class="ds-user-comment">
                    <div class="ds-user-comment-title"><h1>{lang doc:view_yourcomment}</h1><span><i id="star_1"></i><i id="star_2"></i><i id="star_3"></i><i id="star_4"></i><i id="star_5"></i></span><span id="star_num">0 {lang doc:view_xing}</span></div>
                    <div> 
                        <textarea class="ds-user-comment-body" placeholder="{lang doc:view_holdercomment}"></textarea>
                        <!--{if $_G['uid']}-->
                        <div class="ds-user-comment-submit">{lang doc:view_sendcomment}</div>
                        <!--{else}-->
                        <div class="ds-user-comment-submit"><a href="javascript:;" onclick="showWindow('login', 'member.php?mod=logging&action=login')">{lang doc:view_logincomment}</a></div>
                        <!--{/if}-->
                    </div>
                </div>
                <div class="ds-user-comments">
                    <div class="ds-user-comments-title"><h1>{lang doc:view_usercomment}</h1></div>
                    <div id="ds-user-comments-list">
                        {loop GetComment($docid,$pagesize,$cpage) $Comment}
                        <div class="ds-user-comments-list"  commentid="$Comment[0]">
                            <img class="ds-user-comments-upic" src="uc_server/avatar.php?uid=$Comment[5]&size=small" alt=""/>
                            <div class="ds-user-comments-h1"><span style="width:$Comment[2]px" class="ds-user-comments-star"></span><span class="ds-user-comments-user">$Comment[6]</span>$delcomment</div>
                            <div class="ds-user-comments-text">$Comment[1]</div>
                            <div class="ds-user-comments-time">$Comment[3]</div>
                        </div>
                        {/loop}
                    </div>
                    <div class="ds-pagelist">
                        <!--{echo GetCommentPage($docid,$pagesize, $cpage)}-->
                    </div>
                </div> 
            </div>
            <div class="ds-container-right">
                <div class="ds-upload-user">
                    <a href="home.php?mod=space&uid=$userid&do=profile"><img class="ds-upload-user-upic" src="uc_server/avatar.php?uid=$_G['uid']&size=small" alt=""/></a>
                    <div class="ds-upload-user-name">$username</div>
                    <div class="ds-upload-user-time">{lang doc:view_yu} $uploaddate {lang doc:view_upload}</div>
                </div>                
                <div class="ds-rank">  
                    <div class="ds-rank-head">{lang doc:doc_viewrank}</div>                        
                    <ul>
                        {loop GetDocInfo5('','','','',0,1,8,1,'viewcount') $docinfo}
                        <div style='display:none'><!--{echo $doc_star = GetCommentStar($docinfo[0]).'px';}--></div>
                        <li>                                 
                            <div class="ds-rank-title"><i class="$docinfo[1]"></i><a href="<!--{if $doc_rewrite}-->view-$docinfo[0].html<!--{else}-->plugin.php?id=doc:view&d=$docinfo[0]<!--{/if}-->" title="$docinfo[3]">$docinfo[3]</a></div>
                            <div class="ds-rank-dudge"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-docnail-readcount">{lang doc:doc_gong}$docinfo[9]{lang doc:doc_perread}</span></div>                               
                        </li>
                        {/loop}
                    </ul>
                </div>                
            </div>          
        </div>           
    </div>
</div>

<div style="clear:both;height: 50px;"></div>
<!--{template common/footer}-->
