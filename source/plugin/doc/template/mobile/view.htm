<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=$_G['charset']" >
        <meta name="viewport" content="width=device-width, minimum-scale=1.0">
        <title>$navtitle</title>
        <meta name="keywords" content="$metakeywords" />
        <meta name="description" content="$metadescription" />
        <link href="./source/plugin/doc/css/m-doc.css" rel="stylesheet" type="text/css"/>
        <link href="./source/plugin/doc/css/com.css" rel="stylesheet" type="text/css"/>
        <link href="./source/plugin/doc/css/ds-view.css" rel="stylesheet" type="text/css"/>      
        <!--{if $doc_h5}-->
        <link href="plugin.php?id=doc:v&d=$docid&p=fonts" rel="stylesheet" type="text/css"/>
        <!--{/if}-->
        <script src="./source/plugin/doc/js/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
			function embedload(e) {
				e.style.backgroundColor='#fff';
			}
            jQuery.noConflict();
            jQuery(function ($) {

                var doc_width = $("body").width();

                var ish5 = $doc_h5;
				var doccopy = $doc_copy;
                var psize = 5;
                var pshow = 0;
                var pcurrent = 1;
                var pcount = $pcount;
                var freecount = $freepage;
                var pages = $pages;
                var adlist = "$doc_docad".split('|');

                if ($freepage == 0) {
                    $(".ds-page-sp").text("{lang doc:view_payread}$doc_readcreditname[0]:$readpay$doc_readcreditname[1]");
                }
                if (ish5) {
                    jQuery(".ds-page-move").hide();
                }

                CreatePage();

                $(".ds-page-sp").click(function () {
                    if ($(this).text().indexOf("{lang doc:view_readover}") == 0) {
                        return;
                    }
                    if ($(this).text().indexOf("{lang doc:view_payread}") == 0) {
                        OpentRead();
                    }
                    CreatePage();
                });

                function OpentRead()
                {
                    jQuery(".ds-page-move").hide();
                    if (confirm('{lang doc:view_spendextcredits}$doc_readcreditname[0] : $readpay $doc_readcreditname[1] ,[{lang doc:view_vipfreeread}]\n{lang doc:view_sureread}')) {
                        jQuery.post("plugin.php?id=doc:view", {action: "readdoc", d: $docid, readpay: $readpay, touid: $userid, formhash: '{FORMHASH}'}, function (data) {
                            if (data == "1") {
                                freecount = pcount;
                                CreatePage();
                                jQuery(".ds-page-move").show();
                            } else {
                                alert("{lang doc:view_your} $doc_readcreditname[0] {lang doc:view_notenough}");
                                jQuery('.ds-page-move').show();
                            }
                        });
                    } else {
                        jQuery(".ds-page-move").show();
                    }
                }

                function CreatePage() {
                    for (var i = 1; i <= psize; i++) {
                        pshow++;
                        if (pshow <= freecount) {
                            InsertPage(pshow);
                            //ReadPage(p1, pshow);

                            if (pshow >= pcount) {  //==
                                if (pages > pcount)
                                    $(".ds-page-sp").text("{lang doc:view_readover2} " + (pages - pcount) + " {lang doc:view_page}").click(function(){OpentDown();});
                                else
                                    $(".ds-page-sp").text("{lang doc:view_readover}").click(function(){OpentDown();});
                                pshow = pcount;
                                break;
                            }
                            if (pshow >= freecount) {//==
                                $(".ds-page-sp").text("{lang doc:view_payread}$doc_readcreditname[0]:$readpay$doc_readcreditname[1]");
                                pshow = pcount;
                                break;
                            }
                            $(".ds-page-sp").text("{lang doc:view_goread}");
                        } else {
                            pshow = freecount;
                        }
                    }
                }
                function InsertPage(p2) {
                    var url = "plugin.php?id=doc:v" + "&d=$docid" + "&p=" + p2 + "&ish5=" + ish5;
                    if (ish5) {
                        $.ajax({type: "get", url: url, async: false, success: function (page) {
                                $(".ds-pages").append('<div id="page' + p2 + '">' + page + '</div>');
                                if (p2 <= adlist.length && adlist[p2 - 1] != "") {
                                    var ad = '<div class="ds-page-ad">' + adlist[p2 - 1] + '</div>';
                                    $(".ds-pages").append(ad);
                                }
                            }
                        });

                        $(".ds-pages > div").css({"zoom": doc_width / 760});
                    } else {						
						var p = doccopy?'<div><embed onload="embedload(this)" id="page' + p2 + '" src="' + url + '" /></div>':'<div><img onload="embedload(this)" id="page' + p2 + '" src="' + url + '" /></div>';
						$(".ds-pages").append(p);
						if (p2 <= adlist.length && adlist[p2 - 1] != "") {
							var ad = '<div class="ds-page-ad">' + adlist[p2 - 1] + '</div>';
							$(".ds-pages").append(ad);
						}
                    }
                }
                $("#ds-toolbar-left").click(function () {
                    if (pcurrent > 1) {
                        pcurrent--;
                        gopage();
                    }
                });
                $("#ds-toolbar-right").click(function () {
                    if (pcurrent < freecount) {
                        pcurrent++;
                        gopage();
                    }
                });
                function gopage() {
                    $(".ds-toolbar-pcount").val(pcurrent);
                    for (var i = pshow; i < pcurrent + 5; i++) {
                        pshow++;
                        if (pshow <= freecount) {
                            InsertPage(pshow);
                            //ReadPage(p1, pshow);

                            if (pshow >= pcount) {
                                $(".ds-page-sp").text("{lang doc:view_readover}");
                                pshow = pcount;
                                break;
                            }
                            if (pshow >= freecount) {
                                $(".ds-page-sp").text("{lang doc:view_freereadover}");
                                pshow = pcount;
                                break;
                            }
                        } else {
                            pshow--;
                            break;
                        }
                    }
                    location.hash = "page" + pcurrent;
                }
                function GetDocHeight() {
                    return $("#page1").height();
                }
                $(window).scroll(function () {
                    var top = $(window).scrollTop();
                    var alladhei = (GetDocHeight() + 12 + 100) * adlist.length;
                    var fix = $(".ds-pages").offset().top;
                    if (top < alladhei + fix) {
                        pcurrent = (top - fix + GetDocHeight() / 2) / (GetDocHeight() + 12 + 100) + 1;
                    } else {
                        pcurrent = (top - fix - alladhei + GetDocHeight() / 2) / (GetDocHeight() + 12) + adlist.length + 1;
                    }
                    pcurrent = Math.floor(pcurrent);
                    if (pcurrent > pshow)
                        pcurrent = pshow;
                    if (pcurrent < 1) {
                        pcurrent = 1;
                    }
                    $(".ds-toolbar-pcount").val(pcurrent);
                });

                $(".ds-toolbar-pcount").change(function () {
                    var p = parseInt($(".ds-toolbar-pcount").val());
                    if (isNaN(p)) {
                        // do nothing
                    } else if (p < 1) {
                        pcurrent = 1;
                    } else if (p > freecount) {
                        pcurrent = freecount;
                    } else {
                        pcurrent = p;
                    }
                    gopage();
                });
            });
            function OpentDown()
            {
                jQuery(".ds-page-move").hide();
                if (confirm('{lang doc:view_spendextcredits}$doc_downcreditname[0] : $downpay $doc_downcreditname[1] ,[{lang doc:view_vipfreedown}]\n{lang doc:view_suredown}')) {
                    StartDown();
                } else {
                    CloseDown();
                }
            }
            function CloseDown()
            {
                jQuery(".ds-page-move").show();
            }
            function StartDown()
            {
                jQuery(".ds-page-move").show();
                if ($doc_rewrite) {
                    window.location.href = 'down-$docid.html';
                } else {
                    window.location.href = "plugin.php?id=doc:down&d=$docid";
                }
            }
        </script>
    </head>
    <body>
        <div class='m-header'>
            <a href='javascript:javascript:history.back();' class="m-header-return"></a>
            <span>{lang doc:upload_readpay}</span>
            <a href="<!--{if $doc_rewrite}-->doc-doc.html<!--{else}-->plugin.php?id=doc<!--{/if}-->" class="m-header-home">{lang doc:mobile_home}</a>
        </div>
        <div style="clear:both;height: 10px"></div>
        <div class="ds-header">
            <div class="ds-toobar" style="width: 380px">
                <div class="ds-toobar-page"><em id="ds-toolbar-left">&lt;</em><input type="text" class="ds-toolbar-pcount" value="1"/> / <span class="ds-toolbar-ptotal">$pages</span><em id="ds-toolbar-right">&gt;</em></div>
                <div class="ds-toolbar-down">
                    <!--{if $_G['uid']}-->
                    <!--{if in_array($_G[groupid],$doc_downgroups)}-->       
                    <a href="javascript:OpentDown();">{lang doc:view_down}</a>
                    <!--{else}-->
                    <a>{lang doc:view_norightdowndoc}</a>
                    <!--{/if}-->
                    <!--{else}-->							
                    <a href="member.php?mod=logging&action=login">{lang doc:view_logindown}</a>      
                    <!--{/if}-->
                </div>               
            </div>
        </div>
        <div class="ds-container">
            <div class="ds-head">
                <div class="ds-head-title"><i class="$docexeten"></i>$title</div>
                <div class="ds-head-doc"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-judge-i">($doc_commentcount {lang doc:view_percomment})</span><span class="ds-read-count">$viewcount {lang doc:doc_perread}</span><span class="ds-down-count">$downcount {lang doc:doc_perdown}</span></div>
            </div>
            <div class="ds-read">
                <div class="ds-pages">
                </div>
                <div class="ds-page-sp">...</div>
				<ul>
					<!--{if $lastdoc }-->
					<li>{lang doc:view_lastdoc} : <a href="<!--{if $doc_rewrite}-->view-$lastdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$lastdoc[0]<!--{/if}-->" title="$lastdoc[5]">$lastdoc[5]</a></li>
					<!--{else}-->
					<li>{lang doc:view_lastdoc} : {lang doc:view_nodoc}</li>
					<!--{/if}-->
					<!--{if $nextdoc }-->
					<li>{lang doc:view_nextdoc} : <a href="<!--{if $doc_rewrite}-->view-$nextdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$nextdoc[0]<!--{/if}-->" title="$nextdoc[5]">$nextdoc[5]</a></li>
					<!--{else}-->
					<li>{lang doc:view_nextdoc} : {lang doc:view_nodoc}</li>
					<!--{/if}-->
				</ul>			
            </div>
        </div>
        <div style="clear:both;height: 50px;"></div>
    </body>
</html>
