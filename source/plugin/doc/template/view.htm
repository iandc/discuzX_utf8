<!--{template common/header}-->
<link href="./source/plugin/doc/css/com.css" rel="stylesheet" type="text/css"/>
<link href="./source/plugin/doc/css/ds-view.css" rel="stylesheet" type="text/css"/>
<link href="./source/plugin/doc/css/context.css" rel="stylesheet" type="text/css"/>
<!--{if $doc_h5}-->
<link href="plugin.php?id=doc:v&d=$docid&p=fonts" rel="stylesheet" type="text/css"/>
<!--{/if}-->
<script src="./source/plugin/doc/js/jquery.min.js" type="text/javascript"></script>
<script src="./source/plugin/doc/js/context.js" type="text/javascript"></script>
<script type="text/javascript">
	function embedload(e) {
		e.style.backgroundColor='#fff';
	}
    jQuery.noConflict();
    jQuery(function ($) {
        var width = $("#wp").width();
        var lwidth = width - 200;
        var doc_width = lwidth - 4;

        $(".ds-container-left").width(lwidth);

        var ish5 = $doc_h5;
		var doccopy = $doc_copy;
        var psize = 5;
        var pshow = 0;
        var pcurrent = 1;
        var pcount = $pcount;
        var freecount = $freepage;
        var pages = $pages;
        var adlist = "$doc_docad".split('|');

        if ($freepage == 0) {
            $(".ds-page-sp").html("{lang doc:view_payread}$doc_readcreditname[0]:$readpay$doc_readcreditname[1] <span style='margin-left:10px;color:#33AA9B'>[{lang doc:view_viprate}$doc_viprate]<span>");
        }

        CreatePage();

        $(".ds-page-sp").click(function () {
            if ($(this).text().indexOf("{lang doc:view_readover}") == 0) {
                return;
            }
            if ($(this).text().indexOf("{lang doc:view_payread}") == 0) {
                OpentRead();
            }
            CreatePage();
        });

        function OpentRead()
        {
            showDialog('<p>{lang doc:view_spendextcredits}$doc_readcreditname[0]:<span color="#f00">$readpay</span>$doc_readcreditname[1] <span style="margin-left:10px;color:#33AA9B">[{lang doc:view_viprate}$doc_viprate]<span></p>{lang doc:view_sureread}', 'confirm', '{lang doc:view_note}', function () {
                jQuery.post("plugin.php?id=doc:view", {action: "readdoc", d: $docid, readpay: $readpay, touid: $userid, formhash: '{FORMHASH}'}, function (data) {
                    if (data == "1") {
                        freecount = pcount;
                        CreatePage();
                    } else {
                        showDialog("{lang doc:view_your} $doc_readcreditname[0] {lang doc:view_notenough}", "notice", "", "", 0);
                    }
                });
            }, 1, function () {
            });
        }

        function CreatePage() {
            for (var i = 1; i <= psize; i++) {
                pshow++;
                if (pshow <= freecount) {
                    InsertPage(pshow);
                    //ReadPage(p1, pshow);
                    if (pshow >= pcount) {  //==
                        if (pages > pcount)
                            $(".ds-page-sp").text("{lang doc:view_readover2} " + (pages - pcount) + " {lang doc:view_page}").click(function(){OpentDown();});
                        else
                            $(".ds-page-sp").text("{lang doc:view_readover}").click(function(){OpentDown();});
                        pshow = pcount;
                        break;
                    }
                    if (pshow >= freecount) {//==
                        $(".ds-page-sp").html("{lang doc:view_payread}$doc_readcreditname[0]:$readpay$doc_readcreditname[1] <span style='margin-left:10px;color:#33AA9B'>[{lang doc:view_viprate}$doc_viprate]<span>");
                        pshow = pcount;
                        break;
                    }
                    $(".ds-page-sp").text("{lang doc:view_goread}");
                } else {
                    pshow = freecount;
                }
            }
        }
        function InsertPage(p2) {
            var url = "plugin.php?id=doc:v" + "&d=$docid" + "&p=" + p2 + "&ish5=" + ish5;
            if (ish5) {
                $.ajax({type: "get", url: url, async: false, success: function (page) {
                        $(".ds-pages").append('<div id="page' + p2 + '">' + page + '</div>');
                        if (p2 <= adlist.length && adlist[p2 - 1] != "") {
                            var ad = '<div class="ds-page-ad">' + adlist[p2 - 1] + '</div>';
                            $(".ds-pages").append(ad);
                        }
                    }
                });
            } else {
                var p = doccopy?'<div><embed onload="embedload(this)" id="page' + p2 + '" src="' + url + '" /></div>':'<div><img onload="embedload(this)" id="page' + p2 + '" src="' + url + '" /></div>';
                $(".ds-pages").append(p);
                if (p2 <= adlist.length && adlist[p2 - 1] != "") {
                    var ad = '<div class="ds-page-ad">' + adlist[p2 - 1] + '</div>';
                    $(".ds-pages").append(ad);
                }
            }
        }
		
        $("#ds-toolbar-left").click(function () {
            if (pcurrent > 1) {
                pcurrent--;
                gopage();
            }
        });
        $("#ds-toolbar-right").click(function () {
            if (pcurrent < freecount) {
                pcurrent++;
                gopage();
            }
        });
        function gopage() {
            $(".ds-toolbar-pcount").val(pcurrent);
            for (var i = pshow; i < pcurrent + 5; i++) {
                pshow++;
                if (pshow <= freecount) {
                    InsertPage(pshow);
                    //ReadPage(p1, pshow);

                    if (pshow >= pcount) {
                        $(".ds-page-sp").text("{lang doc:view_readover}");
                        pshow = pcount;
                        break;
                    }
                    if (pshow >= freecount) {
                        $(".ds-page-sp").text("{lang doc:view_freereadover}");
                        pshow = pcount;
                        break;
                    }
                } else {
                    pshow--;
                    break;
                }
            }
            location.hash = "page" + pcurrent;
        }
        function GetDocHeight() {
            return $("#page1").height();
        }
        $(window).scroll(function () {
            var top = $(window).scrollTop();
            var alladhei = (GetDocHeight() + 12 + 100) * adlist.length;
            var fix = $(".ds-pages").offset().top;
            if (top < alladhei + fix) {
                pcurrent = (top - fix + GetDocHeight() / 2) / (GetDocHeight() + 12 + 100) + 1;
            } else {
                pcurrent = (top - fix - alladhei + GetDocHeight() / 2) / (GetDocHeight() + 12) + adlist.length + 1;
            }
            pcurrent = Math.floor(pcurrent);
            if (pcurrent > pshow)
                pcurrent = pshow;
            if (pcurrent < 1) {
                pcurrent = 1;
            }
            $(".ds-toolbar-pcount").val(pcurrent);
        });

        $(".ds-toolbar-pcount").change(function () {
            var p = parseInt($(".ds-toolbar-pcount").val());
            if (isNaN(p)) {
                // do nothing
            } else if (p < 1) {
                pcurrent = 1;
            } else if (p > freecount) {
                pcurrent = freecount;
            } else {
                pcurrent = p;
            }
            gopage();
        });

        $(".ds-toolbar-small").click(function () {
            if (doc_width > 560) {
                doc_width -= 100;
                Scale();
            }
        });
        $(".ds-toolbar-large").click(function () {
            if (doc_width < width) {
                doc_width += 100;
                Scale();
            }
        });
        $("#ds-toolbar-full").click(function () {
            if (doc_width == width) {
                doc_width = lwidth;
                $("#ds-toolbar-full").addClass("ds-toolbar-full");
                $("#ds-toolbar-full").removeClass("ds-toolbar-full2");
            } else {
                doc_width = width;
                $("#ds-toolbar-full").addClass("ds-toolbar-full2");
                $("#ds-toolbar-full").removeClass("ds-toolbar-full");
            }
            Scale();
        });
        function Scale() {
            $(".ds-container-left").width(doc_width);
            if (ish5) {
                $(".ds-pages > div").css({"zoom": doc_width / 760});
                if (doc_width > lwidth) {
                    $(".ds-container-right").hide();
                } else {
                    $(".ds-container-right").show();
                }
            } else {

                $(".ds-pages > div > img").width(doc_width - 4);
                if (doc_width > lwidth) {
                    $(".ds-container-right").hide();
                } else {
                    $(".ds-container-right").show();
                }
            }
        }
        $(document).delegate(".ds-pagelist a", "click", function () {
            var p = $(this).attr('p');
            jQuery.post("plugin.php?id=doc:view", {action: "getcomment", d: $docid, p: p, formhash: '{FORMHASH}'}, function (data) {
                var data2 = data.split("|");
                var list = data2[0];
                var page = data2[1];
                $("#ds-user-comments-list").html(list);
                $(".ds-pagelist").html(page);
            });
        });
        $(document).delegate(".ds-user-comments-del", "click", function () {
            var c = $(this).parent().parent();
            var commentid = c.attr("commentid");
            c.remove();
            jQuery.post("plugin.php?id=doc:view", {action: "delcomment", d: $docid, commentid: commentid, formhash: '{FORMHASH}'}, function (data) {
                showDialog(data, "notice", "", "", 0);
            });
        });

        $(".ds-user-comment-submit").click(function () {
            var star = $("#star_num").text();
            star = parseInt(star);
            var comment = $(".ds-user-comment-body").val();
            if (star == 0) {
                showDialog("{lang doc:view_pleasestar}", "notice", "", "", 0);
                return;
            }
            if (comment == "") {
                showDialog("{lang doc:view_pleasecomment}", "notice", "", "", 0);
                return;
            }
            jQuery.post("plugin.php?id=doc:view", {action: "insertcomment", d: $docid, comment: comment, star: star, formhash: '{FORMHASH}'}, function (data) {
                showDialog(data, "notice", "", "", 0);
                star = star * 16.2;
                        $("#ds-user-comments-list").prepend('<div class="ds-user-comments-list"><img class="ds-user-comments-upic" src="uc_server/avatar.php?uid=$_G['uid']&size=small"/><div class="ds-user-comments-h1"><span style="width:' + star + 'px" class="ds-user-comments-star"></span><span class="ds-user-comments-user">$_G['username']</span></div><div class="ds-user-comments-text">' + comment + '</div><div class="ds-user-comments-time">{lang doc:view_yoursoon}</div></div>');
            });
        });

        $(".ds-user-comment-title i").mouseover(function () {
            var star = $(this).attr("id");
            star = star.replace("star_", "");
            for (var i = 1; i <= 5; i++) {
                $("#star_" + i).removeClass("hover");
            }
            for (var i = 1; i <= star; i++) {
                $("#star_" + i).addClass("hover");
            }
            $("#star_num").text(star + " {lang doc:view_xing}");
        });

        if (!ish5 && !doccopy) {
            context.init({preventDoubleContext: false});
            context.settings({compress: true});
            context.attach('.ds-pages img', [
                {text: '{lang doc:view_context_down}', action: function (e) {
                        e.preventDefault();
                        OpentDown();
                    }
                },
                {text: '{lang doc:view_context_refresh}', action: function (e) {
                        e.preventDefault();
                        location.reload();
                    }
                },
                {text: '{lang doc:view_context_goback}', action: function (e) {
                        e.preventDefault();
                        window.history.go(-1);
                    }
                }
            ]);
            $(document).on('mouseover', '.me-codesta', function () {
                $('.finale h1:first').css({opacity: 0});
                $('.finale h1:last').css({opacity: 1});
            });
            $(document).on('mouseout', '.me-codesta', function () {
                $('.finale h1:last').css({opacity: 0});
                $('.finale h1:first').css({opacity: 1});
            });
        }
    });
    function OpentDown()
    {
		<!--{if $_G['uid']}-->
        showDialog('<p>{lang doc:view_spendextcredits}$doc_downcreditname[0]:<span style="color:#f00">$downpay</span>$doc_downcreditname[1] <span style="margin-left:10px;color:#33AA9B">[{lang doc:view_viprate}$doc_viprate]<span></p>{lang doc:view_suredown}', 'confirm', '{lang doc:view_note}', 'StartDown()', 1, 'CloseDown()');
		<!--{else}-->
		showWindow('login', 'member.php?mod=logging&action=login');
		<!--{/if}-->
    }
    function CloseDown()
    {
    }
    function StartDown()
    {
        if ($doc_rewrite) {
            window.location.href = 'down-$docid.html';
        } else {
            window.location.href = 'plugin.php?id=doc:down&d=$docid';
        }
    }
</script>
<div id="wp" class="wp">
    <div id="pt" class="bm cl">
        <div class="z">
            <a class="nvhm" title="$_G['setting']['bbname']" href="./">$_G['setting']['bbname']</a><em></em><a href="<!--{if $doc_rewrite}-->doc-doc.html<!--{else}-->plugin.php?id=doc<!--{/if}-->">$doc_name</a><em></em>{lang doc:view_read}
        </div></div>	
    <div class="wp cl">    
        <div class="ds-header">
            <div class="ds-toobar">
                <div class="ds-toobar-page"><em id="ds-toolbar-left">&lt;</em><input type="text" class="ds-toolbar-pcount" value="1"/> / <span class="ds-toolbar-ptotal">$pages</span><em id="ds-toolbar-right">&gt;</em></div><div class="ds-toolbar-small"></div><div class="ds-toolbar-large"></div><div id="ds-toolbar-full" class="ds-toolbar-full"></div>
                <div class="ds-toolbar-down">
                    <!--{if $_G['uid']}-->
                    <!--{if in_array($_G[groupid],$doc_downgroups)}-->       
                    <a href="javascript:OpentDown();">{lang doc:view_down}</a>
                    <!--{else}-->
                    <a>{lang doc:view_norightdowndoc}</a>
                    <!--{/if}-->
                    <!--{else}-->							
                    <a href="javascript:;" onclick="showWindow('login', 'member.php?mod=logging&action=login')">{lang doc:view_logindown}</a>        
                    <!--{/if}-->
                </div>               
            </div>
            <div class="ds-toolbar-copy">{lang doc:view_copy0}  <a href="http://www.docswf.com">{lang doc:view_copy1}</a>{lang doc:view_copy2}</div>
        </div>
        <div class="ds-container">
            <div class="ds-container-left">
                <div class="ds-head">
                    <div class="ds-head-title"><i class="$docexeten"></i>$title</div>
                    <div class="ds-head-doc"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-judge-i">($doc_commentcount {lang doc:view_percomment})</span><span class="ds-read-count">$viewcount {lang doc:doc_perread}</span><span class="ds-down-count">$downcount {lang doc:doc_perdown}</span></div>
                </div>
                <div class="ds-read">
                    <div class="ds-pages">
                    </div>
                    <div class="ds-page-sp">...</div>
					<ul>
						<!--{if $lastdoc }-->
						<li>{lang doc:view_lastdoc} : <a href="<!--{if $doc_rewrite}-->view-$lastdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$lastdoc[0]<!--{/if}-->" title="$lastdoc[5]">$lastdoc[5]</a></li>
						<!--{else}-->
						<li>{lang doc:view_lastdoc} : {lang doc:view_nodoc}</li>
						<!--{/if}-->
						<!--{if $nextdoc }-->
						<li>{lang doc:view_nextdoc} : <a href="<!--{if $doc_rewrite}-->view-$nextdoc[0].html<!--{else}-->plugin.php?id=doc:view&d=$nextdoc[0]<!--{/if}-->" title="$nextdoc[5]">$nextdoc[5]</a></li>
						<!--{else}-->
						<li>{lang doc:view_nextdoc} : {lang doc:view_nodoc}</li>
						<!--{/if}-->
					</ul>					
                </div>
                <div class="ds-user-comment">
                    <div class="ds-user-comment-title"><h1>{lang doc:view_yourcomment}</h1><span><i id="star_1"></i><i id="star_2"></i><i id="star_3"></i><i id="star_4"></i><i id="star_5"></i></span><span id="star_num">0 {lang doc:view_xing}</span></div>
                    <div> 
                        <textarea class="ds-user-comment-body" placeholder="{lang doc:view_holdercomment}"></textarea>
                        <!--{if $_G['uid']}-->
                        <div class="ds-user-comment-submit">{lang doc:view_sendcomment}</div>
                        <!--{else}-->
                        <div class="ds-user-comment-submit"><a href="javascript:;" onclick="showWindow('login', 'member.php?mod=logging&action=login')">{lang doc:view_logincomment}</a></div>
                        <!--{/if}-->
                    </div>
                </div>
                <div class="ds-user-comments">
                    <div class="ds-user-comments-title"><h1>{lang doc:view_usercomment}</h1></div>
                    <div id="ds-user-comments-list">
                        {loop GetComment($docid,$pagesize,$cpage) $Comment}
                        <div class="ds-user-comments-list"  commentid="$Comment[0]">
                            <img class="ds-user-comments-upic" src="uc_server/avatar.php?uid=$Comment[5]&size=small" alt=""/>
                            <div class="ds-user-comments-h1"><span style="width:$Comment[2]px" class="ds-user-comments-star"></span><span class="ds-user-comments-user">$Comment[6]</span>$delcomment</div>
                            <div class="ds-user-comments-text">$Comment[1]</div>
                            <div class="ds-user-comments-time">$Comment[3]</div>
                        </div>
                        {/loop}
                    </div>
                    <div class="ds-pagelist">
                        <!--{echo GetCommentPage($docid,$pagesize, $cpage)}-->
                    </div>
                </div> 
            </div>
            <div class="ds-container-right">
                <div class="ds-upload-user">
                    <a href="home.php?mod=space&uid=$userid&do=profile"><img class="ds-upload-user-upic" src="uc_server/avatar.php?uid=$userid&size=small" alt=""/></a>
                    <div class="ds-upload-user-name">$username</div>
                    <div class="ds-upload-user-time">{lang doc:view_yu} $uploaddate {lang doc:view_upload}</div>
                </div>                
                <div class="ds-rank">  
                    <div class="ds-rank-head">{lang doc:doc_viewrank}</div>                        
                    <ul>
                        {loop GetDocInfo5('','','','',0,1,8,1,'viewcount') $docinfo}
                        <div style='display:none'><!--{echo $doc_star = GetCommentStar($docinfo[0]).'px';}--></div>
                        <li>                                 
                            <div class="ds-rank-title"><i class="$docinfo[1]"></i><a target="_blank" href="<!--{if $doc_rewrite}-->view-$docinfo[0].html<!--{else}-->plugin.php?id=doc:view&d=$docinfo[0]<!--{/if}-->" title="$docinfo[3]">$docinfo[3]</a></div>
                            <div class="ds-rank-dudge"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-docnail-readcount">{lang doc:doc_gong}$docinfo[9]{lang doc:doc_perread}</span></div>                               
                        </li>
                        {/loop}
                    </ul>
                </div>
                <div class="ds-rank">  
                    <div class="ds-rank-head">{lang doc:doc_linkrank}</div>                   
                    <ul>
                        {loop GetDocInfo5('',$metakeywords,'','',0,1,8,1,'viewcount') $docinfo}
                        <div style='display:none'><!--{echo $doc_star = GetCommentStar($docinfo[0]).'px';}--></div>
                        <li>                                 
                            <div class="ds-rank-title"><i class="$docinfo[1]"></i><a target="_blank" href="<!--{if $doc_rewrite}-->view-$docinfo[0].html<!--{else}-->plugin.php?id=doc:view&d=$docinfo[0]<!--{/if}-->" title="$docinfo[3]">$docinfo[3]</a></div>
                            <div class="ds-rank-dudge"><span class="ds-judge-star"><i style="width:$doc_star"></i></span><span class="ds-docnail-readcount">{lang doc:doc_gong}$docinfo[9]{lang doc:doc_perread}</span></div>                               
                        </li>
                        {/loop}
                    </ul>
                </div>				
            </div>          
        </div>           
    </div>
</div>

<div style="clear:both;height: 50px;"></div>
<!--{template common/footer}-->
